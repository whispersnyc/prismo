# Prisma Template System

Prisma supports two template formats for applying color schemes to applications:

1. **Legacy `.txt` format** - Complete file replacement
2. **New `.prisma` format** - Line-specific and pattern-based updates

## Quick Start

### Creating a .prisma Template

1. Create a new file in `resources/templates/` with `.prisma` extension
2. Define the target output file with `@target`
3. Add directives to specify what to update
4. Use color variables like `{color0}`, `{background}`, `{color1.r}`, etc.

Example:
```prisma
# My App Theme
@target HOME\.config\myapp\theme.conf

@match ".*background.*"
background = {background}

@match ".*foreground.*"
foreground = {foreground}
```

### Adding Template to Config

Edit `config.json` and add your template:

```json
{
    "templates": {
        "discord.txt": "HOME\\AppData\\...",
        "myapp.prisma": "HOME\\.config\\myapp\\theme.conf"
    }
}
```

Note: The output path in config.json can override the `@target` in the template.

## Directives Reference

### @target
Specifies the output file path. Use `HOME` for user home directory.

```prisma
@target HOME\.config\app\settings.json
```

### @line
Replace a specific line number (1-indexed).

```prisma
@line 42
new content for line 42 with {color1}
```

### @lines
Replace a range of lines (inclusive).

```prisma
@lines 10-15
line 10 content
line 11 content
line 12 content
```

### @match
Replace all lines matching a regex pattern.

```prisma
@match ".*primary-color.*"
primary-color = {color4}
```

### @append
Add content to the end of the file.

```prisma
@append
# Generated by Prisma
# Date: 2024
```

### @prepend
Add content to the beginning of the file.

```prisma
@prepend
# Prisma Theme Configuration
```

## Color Variables

### Full Color Values
- `{background}` - Background color
- `{foreground}` - Foreground color
- `{cursor}` - Cursor color
- `{color0}` through `{color15}` - 16 ANSI colors

### RGB Components (0-255)
- `{color0.r}` - Red component
- `{color0.g}` - Green component
- `{color0.b}` - Blue component

### HLS Components
- `{color0.h}` - Hue (0-360)
- `{color0.l}` - Lightness (0-100%)
- `{color0.s}` - Saturation (0-100%)

## Examples

### Example 1: VSCode Settings

```prisma
@target HOME\.vscode\settings.json

@match ".*workbench.colorCustomizations.*"
    "workbench.colorCustomizations": {
        "editor.background": "{background}",
        "editor.foreground": "{foreground}"
    }
```

### Example 2: Terminal Config

```prisma
@target HOME\.config\terminal\config.toml

@match ".*\[colors\].*"
[colors]

@match ".*background.*"
background = "{background}"

@match ".*foreground.*"
foreground = "{foreground}"
```

### Example 3: Using RGB Components

```prisma
@target HOME\.config\app\theme.css

@match ".*--primary-color.*"
--primary-color: rgb({color1.r}, {color1.g}, {color1.b});

@match ".*--accent-hue.*"
--accent-hue: {color4.h};
```

## Tips and Tricks

### 1. Pattern Matching Tips
- Use `.*` to match any characters
- Escape special regex characters: `.`, `*`, `[`, `]`, etc.
- Use `\s*` to allow optional whitespace
- Be specific to avoid unwanted matches

### 2. Working with JSON
Match JSON properties carefully:
```prisma
@match ".*\"background\":\s*\"#[0-9a-fA-F]{6}\".*"
        "background": "{background}",
```

### 3. Working with INI/TOML
Match section headers and keys:
```prisma
@match ".*\[colors\].*"
[colors]

@match ".*background\s*=.*"
background = {background}
```

### 4. Debugging Templates
- Start with simple patterns and test
- Check the output file after applying
- Use the CLI to see errors: `prisma -t yourtemplate.prisma`
- Look at example templates in `resources/templates/`

## Common Patterns

### Update all color definitions in CSS
```prisma
@match ".*--color-bg.*"
--color-bg: {background};

@match ".*--color-fg.*"
--color-fg: {foreground};
```

### Update JSON array of colors
```prisma
@match ".*\"colors\":\s*\[.*"
    "colors": ["{color0}", "{color1}", "{color2}"]
```

### Replace configuration section
```prisma
@lines 50-70
# Color Configuration
bg = {background}
fg = {foreground}
# ... more config
```

## Migrating from .txt to .prisma

If you have a `.txt` template that does full-file replacement, you may want to keep it as-is. The `.prisma` format is best for:

1. Updating existing config files without overwriting them
2. Working with files that have user-specific settings you want to preserve
3. Applications that auto-generate config files

To migrate:
1. Identify what parts of the file actually need color updates
2. Create `.prisma` template with `@match` directives for those sections
3. Test on a copy of your config file
4. Update `config.json` to use the new template

## Troubleshooting

**Error: "No target path specified"**
- Add `@target` directive to your template
- Or specify output path in config.json

**Error: "Invalid regex pattern"**
- Check your pattern for syntax errors
- Escape special characters properly
- Test your regex with a Python regex tester

**Template not applying**
- Verify template file exists in `templates/` folder
- Check config.json has correct template entry
- Ensure template name matches exactly (case-sensitive)
- Enable template in GUI or use `-t` flag in CLI

**Colors not updating**
- Check that pattern matches the target lines
- Verify color variable names are correct
- Look for typos in variable names (case-sensitive)

## See Also

- [TEMPLATE_FORMAT.md](TEMPLATE_FORMAT.md) - Detailed format specification
- [Example templates](resources/templates/) - Ready-to-use examples
- [config.json](config.json) - Template configuration
